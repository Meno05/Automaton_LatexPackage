\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{automaton}[2024/11/11 Custom, Tikz based package for automatons/Graphs for Turing machines]

%Required Packages
\RequirePackage{xstring}
\RequirePackage{etoolbox}
\RequirePackage{expl3}
\RequirePackage{ifthen}

% Load TikZ
\RequirePackage{tikz}
\usetikzlibrary{arrows,decorations.pathmorphing,decorations.pathreplacing,backgrounds,positioning,fit,matrix}
\usetikzlibrary{shapes,calc,automata}

%Wrapper for crating nodes
 \newcommand{\createNode}[3]{
    \node[sstate #1] (z#2) at (#3) {$z_#2$};
 }
%Command to create node
 %use {name of the node(usually incrementing form 0)}{x pos,y pos}}
 \newcommand{\state}[2]{
    \createNode{}{#1}{#2}
 }
 %Command to create start node(same use as standart)
 \newcommand{\startstate}[2]{
    \createNode{,initial by arrow, initial text=}{#1}{#2}
 }
 %Command to create end node(same use as standart)
 \newcommand{\finstate}[2]{
    \createNode{}{#1}{#2}
    \node[state,inner sep=0pt,minimum size=\thecircsize pt] (z#1) at (#2){};
 }

%Defines empty buffer for saving transition command to execute them at the end of a automaton environment(allows definintions to states later defined in the code
\def\alltransitions{}
\newcounter{circsize}

% Wrapper for creating transitions
\newcommand{\createPath}[4]{%
   \listadd{\alltransitions}{\path[->] (z#1) edge [#2] node {$\begin{array}{c}\preprocess{#3}\end{array}$} (z#4);}
   \listadd{\alltransitions}{\\}
}

%Command to create transition(for multiplee transitions on one arrow use {a:b,R|c:c,R} syntax)
%use [left] or [right] befor other args to use custom bend direction
\newcommand{\transition}[4][]{

    \ifthenelse{\equal{#2}{#3}}%
    {\createPath{#2}{loop above}{#4}{#3}}%
    {
    \ifx&#1&%
        \createPath{#2}{#1}{#4}{#3}
    \else
        \createPath{#2}{bend #1}{#4}{#3}
    \fi
    }
}
%Allows to use | in the transition definiton and have it be interpreted as a \\
\ExplSyntaxOn
\newcommand{\preprocess}[1]{
    \tl_set:Nx \l_tmpa_tl { #1 } % Store #1 in a temporary variable
    \tl_replace_all:Nnn \l_tmpa_tl {|}{\\} % Replace | with \\ in l_tmpa_tl
    \l_tmpa_tl
}
\ExplSyntaxOff

%creates environment for automatons with x circlesize
\newenvironment{automaton}[1][30]
    {
    \setcounter{circsize}{#1}
    \addtocounter{circsize}{4}
    \def\alltransitions{}
    
    \begin{tikzpicture}[auto,>=stealth',scale=2]
    \tikzstyle{sstate}=[state,inner sep=0pt,minimum size=30pt]
}
{
    \alltransitions
    \end{tikzpicture}
}
%%Example Use of the Function
%\begin{automaton}
%        \startstate{0}{0,0.84}
%        \transition[left]{0}{1}{\Box:1, R|1:1, L}
%
%        \state{1}{1,0}
%        \transition[left]{1}{0}{\Box:1, L}
%        \transition{1}{2}{1:1, L}

%        \state{2}{2.3,0}
%        \transition{2}{2}{1:1, R}
%        \transition{2}{3}{\Box:\Box, L}

%        \state{3}{3.6,0}
%        \transition{3}{3}{1:\Box,L}
%        \transition{3}{4}{\Box:\Box, L}

%        \finstate{4}{4.9,0}
%    \end{automaton}



